(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e96a919"],{"058a":function(e,r,t){"use strict";t.d(r,"h",(function(){return o})),t.d(r,"j",(function(){return n})),t.d(r,"k",(function(){return i})),t.d(r,"l",(function(){return a})),t.d(r,"i",(function(){return c})),t.d(r,"d",(function(){return l})),t.d(r,"a",(function(){return u})),t.d(r,"g",(function(){return d})),t.d(r,"f",(function(){return p})),t.d(r,"c",(function(){return g})),t.d(r,"e",(function(){return m})),t.d(r,"b",(function(){return f}));var s="http://60qb8761xi36.vicp.fun",o=s+"/api/users/getAll",n=s+"/api/users/register",i=s+"/api/users/register_application/approve",a=s+"/api/users",c=s+"/api/users/login",l=s+"/api/questions/categories",u=s+"/api/records/user",d=s+"/api/users/register_application",p=s+"/api/records",g=s+"/api/questions/batch",m=s+"/api/questions/category",f=s+"/api/questions/category"},2646:function(e,r,t){},3411:function(e,r,t){"use strict";t("563e")},"563e":function(e,r,t){},"92c0":function(e,r,t){"use strict";t("2646")},"9ed6":function(e,r,t){"use strict";t.r(r);var s=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"login-container"},[t("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,"auto-complete":"on","label-position":"left"}},[t("div",{staticClass:"image-container"},[t("img",{staticClass:"centered-image",attrs:{src:"https://upload.wikimedia.org/wikipedia/zh/8/81/%E6%B0%B8%E9%81%A0%E5%BF%A0%E8%AA%A0%E6%BD%9B%E9%BE%8D%E9%9A%8A%E5%BE%BD.png",alt:"中華民國海軍陸戰隊新兵訓練中心標誌",width:"150",height:"150"}})]),t("div",{staticClass:"title-container"},[t("h3",{staticClass:"title"},[e._v("登入系統")])]),t("el-form-item",{attrs:{prop:"username"}},[t("span",{staticClass:"svg-container"},[t("svg-icon",{attrs:{"icon-class":"user"}})],1),t("el-input",{ref:"username",attrs:{placeholder:"用戶名",name:"username",type:"text",tabindex:"1","auto-complete":"on"},model:{value:e.loginForm.username,callback:function(r){e.$set(e.loginForm,"username",r)},expression:"loginForm.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("span",{staticClass:"svg-container"},[t("svg-icon",{attrs:{"icon-class":"password"}})],1),t("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,placeholder:"密碼",name:"password",tabindex:"2","auto-complete":"on"},nativeOn:{keyup:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.handleLogin(r)}},model:{value:e.loginForm.password,callback:function(r){e.$set(e.loginForm,"password",r)},expression:"loginForm.password"}}),t("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[t("svg-icon",{attrs:{"icon-class":"password"===e.passwordType?"eye":"eye-open"}})],1)],1),t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{loading:e.loading,type:"primary"},nativeOn:{click:function(r){return r.preventDefault(),e.handleLogin(r)}}},[e._v("登入")]),t("el-button",{attrs:{type:"info"},on:{click:e.showRegisterForm}},[e._v("註冊")])],1),t("el-dialog",{attrs:{title:"註冊",visible:e.registerFormVisible,width:"80%","custom-class":"register-dialog"},on:{"update:visible":function(r){e.registerFormVisible=r}}},[t("el-form",{ref:"registerForm",staticClass:"register-form",attrs:{model:e.registerForm,rules:e.registerRules}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.registerForm.name,callback:function(r){e.$set(e.registerForm,"name",r)},expression:"registerForm.name"}})],1),t("el-form-item",{attrs:{label:"帳號",prop:"account"}},[t("el-input",{model:{value:e.registerForm.account,callback:function(r){e.$set(e.registerForm,"account",r)},expression:"registerForm.account"}})],1),t("el-form-item",{attrs:{label:"密碼",prop:"password"}},[t("el-input",{attrs:{type:"password"},model:{value:e.registerForm.password,callback:function(r){e.$set(e.registerForm,"password",r)},expression:"registerForm.password"}})],1),t("el-form-item",{attrs:{label:"確認密碼",prop:"confirmPassword"}},[t("el-input",{attrs:{type:"password"},model:{value:e.registerForm.confirmPassword,callback:function(r){e.$set(e.registerForm,"confirmPassword",r)},expression:"registerForm.confirmPassword"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(r){e.registerFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleRegister}},[e._v("確定註冊")])],1)],1)],1)],1)},o=[],n=t("c7eb"),i=t("5530"),a=t("1da1"),c=(t("e9c4"),t("d3b7"),t("058a")),l={name:"Login",data:function(){var e=this,r=function(r,t,s){t!==e.registerForm.password?s(new Error("兩次輸入的密碼不一致")):s()};return{loginForm:{username:"",password:"",role:"admin"},loginRules:{username:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur"}]},loading:!1,passwordType:"password",redirect:void 0,userRole:"",registerFormVisible:!1,registerForm:{name:"",account:"",password:"",confirmPassword:"",role:"editor"},registerRules:{name:[{required:!0,message:"請輸入姓名",trigger:"blur"}],account:[{required:!0,message:"請輸入帳號",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"}],confirmPassword:[{required:!0,message:"請再次輸入密碼",trigger:"blur"},{validator:r,trigger:"blur"}]}}},watch:{$route:{handler:function(e){this.redirect=e.query&&e.query.redirect},immediate:!0}},methods:{showPwd:function(){var e=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){e.$refs.password.focus()}))},handleLogin:function(){var e=this;return Object(a["a"])(Object(n["a"])().mark((function r(){var t;return Object(n["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$refs.loginForm.validate();case 3:if(t=r.sent,console.log("valid",t),!t){r.next=17;break}return e.loading=!0,r.next=9,e.fetchUserRole();case 9:return e.loginForm.role=e.userRole,console.log("this.userRole",e.userRole),console.log("this.loginForm.username",e.loginForm.username),console.log("this.loginForm.password",e.loginForm.password),console.log("this.loginForm.role",e.loginForm.role),r.next=16,e.$store.dispatch("user/login",Object(i["a"])({},e.loginForm));case 16:e.$router.push({path:e.redirect||"/"});case 17:r.next=22;break;case 19:r.prev=19,r.t0=r["catch"](0),console.error("登入失敗:",r.t0);case 22:return r.prev=22,e.loading=!1,r.finish(22);case 25:case"end":return r.stop()}}),r,null,[[0,19,22,25]])})))()},fetchUserRole:function(){var e=this;return Object(a["a"])(Object(n["a"])().mark((function r(){var t,s;return Object(n["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,fetch(c["i"],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:e.loginForm.username,password:e.loginForm.password})});case 3:return t=r.sent,r.next=6,t.json();case 6:s=r.sent,1===s.code&&s.data?(e.userRole=s.data.role,console.log("用戶角色",s.data)):(console.error("獲取用戶資料失敗:",s.msg),e.userRole=""),r.next=14;break;case 10:r.prev=10,r.t0=r["catch"](0),console.error("獲取用戶角色時發生錯誤:",r.t0),e.userRole="";case 14:case"end":return r.stop()}}),r,null,[[0,10]])})))()},showRegisterForm:function(){this.registerFormVisible=!0},handleRegister:function(){var e=this;return Object(a["a"])(Object(n["a"])().mark((function r(){var t,s,o;return Object(n["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$refs.registerForm.validate();case 3:if(t=r.sent,!t){r.next=12;break}return r.next=7,fetch(c["g"],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.registerForm)});case 7:return s=r.sent,r.next=10,s.json();case 10:o=r.sent,1===o.code?(e.$message.success("已提交給管理員"),e.registerFormVisible=!1):e.$message.error("註冊失敗: "+o.msg);case 12:r.next=18;break;case 14:r.prev=14,r.t0=r["catch"](0),console.error("註冊失敗:",r.t0),e.$message.error("註冊失敗，請稍後再試");case 18:case"end":return r.stop()}}),r,null,[[0,14]])})))()}}},u=l,d=(t("3411"),t("92c0"),t("2877")),p=Object(d["a"])(u,s,o,!1,null,"0b73c5d2",null);r["default"]=p.exports},e9c4:function(e,r,t){var s=t("23e7"),o=t("d066"),n=t("d039"),i=o("JSON","stringify"),a=/[\uD800-\uDFFF]/g,c=/^[\uD800-\uDBFF]$/,l=/^[\uDC00-\uDFFF]$/,u=function(e,r,t){var s=t.charAt(r-1),o=t.charAt(r+1);return c.test(e)&&!l.test(o)||l.test(e)&&!c.test(s)?"\\u"+e.charCodeAt(0).toString(16):e},d=n((function(){return'"\\udf06\\ud834"'!==i("\udf06\ud834")||'"\\udead"'!==i("\udead")}));i&&s({target:"JSON",stat:!0,forced:d},{stringify:function(e,r,t){var s=i.apply(null,arguments);return"string"==typeof s?s.replace(a,u):s}})}}]);